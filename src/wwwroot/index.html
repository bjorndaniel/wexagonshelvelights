<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible"
        content="IE=edge">
    <meta name="viewport"
        content="width=device-width, initial-scale=1">
    <title>Wexagon shelve lights</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        rel="stylesheet">
    <link href="css/app.css"
        rel="stylesheet">
    <link href="css/hexgrid.css"
        rel="stylesheet">

</head>

<body class="text-center"
    cz-shortcut-listen="true">
    <app>
        <!--!-->
        <!--!-->
        <!--!-->
        <!--!-->
        <!--!-->
        <div class="cover-container d-flex h-100 p-3 mx-auto flex-column">
            <main role="main"
                class="inner cover">
                <!--!-->
                <!--!-->
                <h1 class="cover-heading">Wexagon lights</h1>
                <h1 class="cover-heading">Select a figure and its color.</h1>
                <div class="row align-middle">
                    <div class="col align-middle my-auto">
                        <fieldset>
                            <label class="label"
                                for="pickerall">Set all:&nbsp; </label><input type="color"
                                id="pickerall" />
                        </fieldset>

                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <div class="hex-grid">
                            <ul class="hex-grid__list">
                                <li class="hex-grid__item">
                                    <div class="hex-grid__content">
                                        <input type="color"
                                            data-nr="17"
                                            class="js-picker hide">
                                    </div>
                                </li>
                                <li class="hex-grid__item hide">
                                    <div class="hex-grid__content">
                                        1
                                    </div>
                                </li>
                                <li class="hex-grid__item">
                                    <div class="hex-grid__content">
                                        <input type="color"
                                            data-nr="16"
                                            class="js-picker hide">
                                    </div>
                                </li>
                                <li class="hex-grid__item hide  ">
                                    <div class="hex-grid__content">
                                        1
                                    </div>
                                </li>
                                <li class="hex-grid__item">
                                    <div class="hex-grid__content">
                                        <input type="color"
                                            data-nr="15"
                                            class="js-picker hide">
                                    </div>
                                </li>
                                <li class="hex-grid__item">
                                    <div class="hex-grid__content">
                                        <input type="color"
                                            data-nr="10"
                                            class="js-picker hide">
                                    </div>
                                </li>
                                <li class="hex-grid__item">
                                    <div class="hex-grid__content">
                                        <input type="color"
                                            data-nr="11"
                                            class="js-picker hide">
                                    </div>
                                </li>
                                <li class="hex-grid__item">
                                    <div class="hex-grid__content">
                                        <input type="color"
                                            data-nr="12"
                                            class="js-picker hide">
                                    </div>
                                </li>
                                <li class="hex-grid__item">
                                    <div class="hex-grid__content">
                                        <input type="color"
                                            data-nr="13"
                                            class="js-picker hide">
                                    </div>
                                </li>
                                <li class="hex-grid__item">
                                    <div class="hex-grid__content">
                                        <input type="color"
                                            data-nr="14"
                                            class="js-picker hide">
                                    </div>
                                </li>
                                <li class="hex-grid__item">
                                    <div class="hex-grid__content">
                                        <input type="color"
                                            data-nr="9"
                                            class="js-picker hide">
                                    </div>
                                </li>
                                <li class="hex-grid__item">
                                    <div class="hex-grid__content">
                                        <input type="color"
                                            data-nr="8"
                                            class="js-picker hide">
                                    </div>
                                </li>
                                <li class="hex-grid__item">
                                    <div class="hex-grid__content">
                                        <input type="color"
                                            data-nr="7"
                                            class="js-picker hide">
                                    </div>
                                </li>
                                <li class="hex-grid__item">
                                    <div class="hex-grid__content">
                                        <input type="color"
                                            data-nr="6"
                                            class="js-picker hide">
                                    </div>
                                </li>
                                <li class="hex-grid__item">
                                    <div class="hex-grid__content">
                                        <input type="color"
                                            data-nr="5"
                                            class="js-picker hide">
                                    </div>
                                </li>
                                <li class="hex-grid__item">
                                    <div class="hex-grid__content">
                                        <input type="color"
                                            data-nr="0"
                                            class="js-picker hide">
                                    </div>
                                </li>
                                <li class="hex-grid__item">
                                    <div class="hex-grid__content">
                                        <input type="color"
                                            data-nr="1"
                                            class="js-picker hide">
                                    </div>
                                </li>
                                <li class="hex-grid__item">
                                    <div class="hex-grid__content">
                                        <input type="color"
                                            data-nr="2"
                                            class="js-picker hide">
                                    </div>
                                </li>
                                <li class="hex-grid__item">
                                    <div class="hex-grid__content">
                                        <input type="color"
                                            data-nr="3"
                                            class="js-picker hide">
                                    </div>
                                </li>
                                <li class="hex-grid__item">
                                    <div class="hex-grid__content">
                                        <input type="color"
                                            data-nr="4"
                                            class="js-picker hide">
                                    </div>
                                </li>

                            </ul>
                        </div>
                    </div>
                </div>
            </main>
            <!--!-->
            <!--!-->
            <footer class="mastfoot mt-auto">
                <div class="inner">
                    <p><a href="https://github.com/bjorndaniel/wexagonshelvelights"
                            target="_blank">Checkout the code on github</a>
                    </p>
                </div>
            </footer>
            <!--!-->
            <!--!-->
        </div>
        <!--!-->
    </app>
    <script>
        window.addEventListener('load', (e) => {
            const hexagons = document.querySelectorAll('.hex-grid__item');
            hexagons.forEach(item => {
                item.addEventListener('click', (e) => {
                    const picker = e.target.querySelector('.js-picker');
                    if (picker) {
                        picker.click();
                    }
                });
            })
            const pickers = document.querySelectorAll('.js-picker');
            pickers.forEach(item => {
                item.addEventListener('change', (e) => {
                    const parent = e.target.parentNode;
                    if (parent) {
                        parent.style.backgroundColor = e.target.value;
                        const rgb = HEX2RGB(e.target.value);
                        const data = {
                            nr: e.target.dataset.nr,
                            rgb: rgb
                        };
                        fetch('/light', {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(data)
                        })
                            .then(r => console.log(r));
                    }

                });
            });
            const pickerAll = document.getElementById('pickerall');
            pickerAll.addEventListener('change', (e) => {
                const hexagons = document.querySelectorAll('.hex-grid__content');
                hexagons.forEach((hex) => {
                    hex.style.backgroundColor = e.target.value;
                });
                const rgb = HEX2RGB(e.target.value);

                fetch('/all', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(rgb)
                })
                    .then(r => console.log(r));

            });
        });
        //From: https://gist.github.com/comficker/871d378c535854c1c460f7867a191a5a#file-hex2rgb-js
        function HEX2RGB(hex) {
            "use strict";
            if (hex.charAt(0) === '#') {
                hex = hex.substr(1);
            }
            if ((hex.length < 2) || (hex.length > 6)) {
                return false;
            }
            var values = hex.split(''),
                r,
                g,
                b;

            if (hex.length === 2) {
                r = parseInt(values[0].toString() + values[1].toString(), 16);
                g = r;
                b = r;
            } else if (hex.length === 3) {
                r = parseInt(values[0].toString() + values[0].toString(), 16);
                g = parseInt(values[1].toString() + values[1].toString(), 16);
                b = parseInt(values[2].toString() + values[2].toString(), 16);
            } else if (hex.length === 6) {
                r = parseInt(values[0].toString() + values[1].toString(), 16);
                g = parseInt(values[2].toString() + values[3].toString(), 16);
                b = parseInt(values[4].toString() + values[5].toString(), 16);
            } else {
                return false;
            }
            return [r, g, b];
        }
    </script>
</body>

</html>